# Lab 2 Report

## 练习1

所涉及的四个函数改动如下：

- `default_init`：没有改动；
- `default_init_memmap`：没有改动；
- `default_alloc_pages`：此函数分两部分：遍历链表寻找足够大的块、将此块中所需部分取出并将剩余部分插入链表。前一部分原来的实现是正确的，故没有改动。后一部分原来的实现中，是将块中剩余的部分直接插入到了链表头之后，而没有维护链表中块地址的有序性，故改为将块中剩余的部分插入到此块原来所在的位置处。
- `default_free_pages`：此函数分两部分：设置被释放页的属性、将这些页插入链表。前一部分原来的实现是正确的，故没有改动。后一部分改为如下实现：首先将被释放的页作为单独一个块插入链表中相应的位置，然后尽量与其左侧邻接的块合并，再尽量与其右侧邻接的块合并。

### 你的first fit算法是否有进一步的改进空间

改进空间如下：

1. 目前`default_alloc_pages`的实现中，如果申请`n`页，而找到的块只比`n`大一点，例如`n+1`页，那么这剩下的一页也会被重新插入链表。这会使链表中形成大量碎片，影响此后遍历链表的性能。一个合理的改进是：块中剩余的页数大于某个阈值时，才将其重新插入链表；
2. 目前同一个页表的`default_init_memmap`函数只能被执行一次，即不能多次向同一个页表新增可分配空间。如果要支持被执行多次，则需在此函数中遍历链表，将新分配的块插入到链表中适当的位置上，以保证链表中地址的单调性。